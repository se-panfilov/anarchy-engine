import type { IShowcase } from '@/App/Levels/Models';
import type { IActorWrapper, IAnimationParams, IAppCanvas, ILevel, ILevelConfig } from '@/Engine';
import { ambientContext, buildLevelFromConfig, Easing, isNotDefined, standardMoverService } from '@/Engine';

import levelConfig from './showcase-level-5.config.json';

//Showcase 4: Anime.js complex animations (easing, etc.)
export function showcaseLevel(canvas: IAppCanvas): IShowcase {
  const level: ILevel = buildLevelFromConfig(canvas, levelConfig as ILevelConfig);

  function start(): void {
    level.start();
    const { actorRegistry, cameraRegistry, controlsRegistry } = level.entities;

    controlsRegistry.getAll()[0]?.entity.target.set(6, 0, 0);
    cameraRegistry.getAll()[0]?.setPosition(6, 30, 0);

    const topActor: IActorWrapper | undefined = actorRegistry.getUniqByTag('top_actor');
    const centralActor: IActorWrapper | undefined = actorRegistry.getUniqByTag('central_actor');
    const bottomActor: IActorWrapper | undefined = actorRegistry.getUniqByTag('bottom_actor');
    if (isNotDefined(topActor) || isNotDefined(centralActor) || isNotDefined(bottomActor)) throw new Error('Actors are not defined');

    let isClickBlocked: boolean = false;

    const animationParams: IAnimationParams = {
      duration: 2000,
      direction: 'alternate'
    };

    ambientContext.mouseClickWatcher.value$.subscribe(() => {
      if (isClickBlocked) {
        console.log('click is blocked');
        isClickBlocked = false;
        return;
      }
      console.log('click is ready', !isClickBlocked);
      isClickBlocked = true;

      //soft complex movement
      // const arr = [...Array(20)].map((v, i) => i);
      const arr = [
        1482.8, 1491.1, 1499.5, 1507.9, 1516.1, 1524.6, 1533, 1541.2, 1549.4, 1557.9, 1566.1, 1574.6, 1582.9, 1591.2, 1599.6, 1607.7, 1616.1, 1624.6, 1632.9, 1641.1, 1649.4, 1657.8, 1666.1, 1674.4,
        1682.7, 1691, 1699.5, 1707.8, 1716.1, 1724.5, 1732.8, 1741, 1749.4, 1757.6, 1766.1, 1774.4, 1782.7, 1791.1, 1799.3, 1807.8, 1816, 1824.5, 1832.8, 1841.1, 1849.3, 1857.7, 1865.9, 1874.3,
        1882.5, 1891, 1899.4, 1907.6, 1916, 1924.3, 1932.6, 1941.2, 1949.4, 1957.6, 1965.9, 1974.4, 1982.7, 1990.9, 1999.3, 2007.7, 2015.9, 2024.4, 2032.6, 2040.8, 2049.2, 2057.6, 2065.8, 2074.2,
        2082.6, 2090.9, 2099.3, 2107.5, 2115.9, 2124.3, 2132.6, 2140.9, 2149.2, 2157.5, 2165.9, 2174.1, 2182.5, 2190.9, 2199.2, 2207.6, 2215.8, 2224.2, 2232.5, 2240.7, 2249.1, 2257.4, 2265.8, 2274.1,
        2282.5, 2291, 2299, 2307.5, 2315.7, 2324.2, 2332.5, 2340.7, 2349.2, 2357.5, 2365.7, 2374.1, 2382.4, 2390.6, 2399, 2407.3, 2415.8, 2424, 2432.3, 2440.8, 2449, 2457.4, 2465.7, 2474, 2482.3,
        2490.7, 2498.9, 2507.3, 2515.8, 2524.1, 2532.5, 2540.8, 2548.9, 2557.4, 2565.6, 2574, 2582.4, 2590.6, 2599.1, 2607.2, 2615.5, 2624, 2632.4, 2640.7, 2648.9, 2657.2, 2665.5, 2674, 2682.2,
        2690.6, 2699, 2707.2, 2715.6, 2723.8, 2732.2, 2740.6, 2749.1, 2757.1, 2765.6, 2774, 2782.2, 2790.5, 2799, 2807.3, 2815.6, 2823.8, 2832.2, 2840.6, 2848.9, 2857.3, 2865.5, 2873.9, 2882.1,
        2890.4, 2898.8, 2907, 2915.4, 2923.8, 2932, 2940.5, 2948.8, 2957.2, 2965.5, 2973.7, 2982.1, 2990.3, 2998.7, 3007.1, 3015.4, 3023.7, 3032.2, 3040.4, 3048.7, 3057, 3065.4, 3073.8, 3082, 3090.5,
        3098.7, 3107.1, 3115.5, 3123.8, 3132.2, 3140.5, 3148.7, 3157, 3165.4, 3173.7, 3181.8, 3190.3, 3198.7, 3207, 3215.5, 3223.6, 3231.9, 3240.4, 3248.7, 3256.9, 3265.4, 3273.6, 3281.9, 3290.1,
        3298.6, 3307, 3315.4, 3323.5, 3331.9, 3340.3, 3348.5, 3356.9, 3365.4, 3373.5, 3381.9, 3390.2, 3398.7, 3407, 3415.2, 3423.5, 3431.8, 3440.2, 3448.6, 3457, 3465.1, 3473.4, 3481.8, 3490.2,
        3498.6, 3506.9, 3515.2, 3523.5, 3531.8, 3540.2, 3548.5, 3557, 3565.1, 3573.5, 3581.7, 3590, 3598.4, 3606.7, 3615.1, 3623.5, 3631.8, 3640.1, 3648.5, 3656.6, 3665.1, 3673.4, 3681.7, 3690,
        3698.3, 3706.7, 3715, 3723.4, 3731.7, 3740.1, 3748.3, 3756.8, 3765, 3773.5, 3781.6, 3790.2, 3798.4, 3806.9, 3815.2, 3823.5, 3831.7, 3840, 3848.3, 3856.8, 3865, 3873.3, 3881.6, 3890.1, 3898.3,
        3906.6, 3914.9, 3923.3, 3931.6, 3939.9, 3948.2, 3956.5, 3964.9, 3973.2, 3981.5, 3989.8, 3998.2, 4006.5, 4014.9, 4023.2, 4031.6, 4039.8, 4048.4, 4056.6, 4064.9, 4073.3, 4081.6, 4089.9, 4098.1,
        4106.7, 4114.8, 4123.3, 4131.5, 4140, 4148.1, 4156.6, 4164.9, 4173.1, 4181.6, 4189.7, 4198.1, 4206.5, 4214.8, 4223.1, 4231.5, 4239.7, 4248.2, 4256.4, 4264.7, 4273.3, 4281.6, 4289.7, 4298.1,
        4306.5, 4314.8, 4323.1, 4331.5, 4339.8, 4348, 4356.3, 4364.7, 4373.1, 4381.5, 4389.7, 4398, 4406.5, 4414.6, 4423, 4431.4, 4439.6, 4448, 4456.5, 4464.8, 4473.1, 4481.3, 4489.6, 4498, 4506.4,
        4514.6, 4522.9, 4531.4, 4539.5, 4548, 4556.4, 4564.6, 4573.1, 4581.5, 4589.7, 4598, 4606.2, 4614.6, 4623, 4631.2, 4639.8, 4647.9, 4656.2, 4664.6, 4673.1, 4681.3, 4689.8, 4698, 4706.3, 4714.7,
        4722.9, 4731.1, 4739.5, 4748, 4756.2, 4764.5, 4772.8, 4781.2, 4789.6, 4797.8, 4806.2, 4814.6, 4822.9, 4831.1, 4839.5, 4847.8, 4856.1, 4864.4, 4873, 4881.2, 4889.5, 4898, 4906.2, 4914.5,
        4922.7, 4931.2, 4939.4, 4947.7, 4956.1, 4964.4, 4972.7, 4981, 4989.5, 4997.8, 5006.1, 5014.3, 5022.6, 5031.1, 5039.4, 5047.6, 5056.2, 5064.5, 5072.7, 5080.9, 5089.6, 5097.6, 5105.9, 5114.4,
        5122.8, 5131.1, 5139.4, 5147.8, 5156, 5164.4, 5172.7, 5180.9, 5189.3, 5197.7, 5206.3, 5214.3, 5222.7, 5231, 5239.3, 5247.9, 5256.2, 5264.6, 5273, 5280.8, 5289.3, 5297.9, 5306.2, 5314.6,
        5322.9, 5331, 5339.2, 5347.5, 5356, 5364.6, 5372.9, 5381.2, 5389.6, 5397.9, 5405.7, 5414.2, 5422.5, 5431.1, 5439.5, 5447.6, 5456.2, 5464.1, 5472.5, 5481.1, 5489.5, 5497.9, 5505.8, 5514.5,
        5522.8, 5530.7, 5539.2, 5547.8, 5556.2, 5564.3, 5572.7, 5580.8, 5589, 5597.5, 5605.8, 5614.1, 5622.7, 5631.1, 5639.4, 5647.7, 5655.7, 5664, 5672.7, 5680.7, 5689.4, 5697.6, 5706, 5714, 5722.5,
        5730.6, 5739.1, 5747.7, 5756.1, 5763.9, 5772.4, 5780.7, 5789.3, 5797.7, 5805.9, 5814.4, 5822.6, 5831, 5839, 5847.6, 5855.8, 5863.9, 5872.3, 5880.6, 5889, 5897.3, 5905.7, 5913.9, 5922.3,
        5930.9, 5939.3, 5947.6, 5955.9, 5963.9, 5972.3, 5980.6, 5989.2, 5997.6, 6005.7, 6014.3, 6022.1, 6030.5, 6038.9, 6047.2, 6055.8, 6064.2, 6072.6, 6080.8, 6088.8, 6097.2, 6105.8, 6114.1, 6122.3,
        6130.5, 6139, 6147.1, 6155.5, 6163.8, 6172.2, 6180.8, 6189.1, 6197.4, 6205.5, 6213.9, 6222.1, 6230.5, 6238.7, 6247.2, 6255.4, 6263.9, 6272.1, 6280.4, 6288.8, 6297.2, 6305.4, 6314.1, 6322.1,
        6330.4, 6338.7, 6347.1, 6355.4, 6364.1, 6372.3, 6380.6, 6389, 6397, 6405.4, 6413.6, 6422.1, 6430.7, 6439, 6447.4, 6455.6, 6463.6, 6472, 6480.4, 6488.9, 6497.3, 6505.3, 6513.7, 6521.9, 6530.6,
        6538.7, 6546.9, 6555.6, 6564, 6572.3, 6580.7, 6588.6, 6596.9, 6605.4, 6613.9, 6622.2, 6630.6, 6638.7, 6647.2, 6655.2, 6663.5, 6671.9, 6680.5, 6689, 6697.2, 6705.2, 6713.5, 6722.2, 6730.6,
        6738.8, 6746.8, 6755.5, 6763.8, 6771.8, 6780.2, 6788.4, 6796.9, 6805.2, 6813.8, 6822.2, 6830.5, 6838.4, 6847.2, 6855.4, 6863.5, 6871.8, 6880.4, 6888.9, 6896.8, 6905.5, 6913.8, 6921.8, 6930.4,
        6938.7, 6947.2, 6955.5, 6963.3, 6971.8, 6980.4, 6988.7, 6996.7, 7005.4, 7013.7, 7021.7, 7030, 7038.4, 7047, 7055.4, 7063.8, 7071.9, 7080.3, 7088.3, 7096.7, 7105.2, 7113.7, 7122, 7130.3,
        7138.7, 7147, 7154.9, 7163.3, 7171.7, 7179.9, 7188.7, 7196.7, 7205.3, 7213.3, 7221.6, 7230.2, 7238.3, 7246.6, 7255.3, 7263.6, 7271.9, 7279.9, 7288.4, 7296.7, 7305, 7313.5, 7321.6, 7329.9,
        7338.6, 7346.5, 7354.9, 7363.2, 7371.7, 7380.3, 7388.6, 7396.9, 7404.8, 7413.1, 7421.9, 7430.2, 7438.4, 7446.5, 7454.9, 7463.3, 7471.4, 7479.8, 7488.1, 7496.7, 7505.2, 7513.4, 7521.5, 7529.7,
        7538.1, 7546.5, 7554.8, 7563.4, 7571.8, 7580.1, 7588.4, 7596.4, 7604.7, 7613.4, 7621.8, 7629.6, 7638.1, 7646.8, 7655.1, 7663.1, 7671.4, 7679.8, 7688.1, 7696.7, 7705.1, 7713.4, 7721.3, 7729.7,
        7738, 7746.4, 7755, 7763.3, 7771.7, 7780, 7788, 7796.6, 7805, 7813.3, 7821.7, 7830, 7838.3, 7846.3, 7854.5, 7863.1, 7871.4, 7879.7, 7888, 7896.6, 7904.9, 7912.9, 7921.3, 7929.9, 7938.2,
        7946.3, 7955, 7963, 7971.2, 7979.7, 7988.1, 7996.6, 8004.8, 8013.3, 8021.2, 8029.5, 8037.8, 8046.3, 8054.5, 8062.9, 8071.2, 8079.5, 8087.9, 8096.2, 8104.5, 8112.8, 8121.1, 8129.5, 8137.9,
        8146.3, 8154.6, 8162.8, 8171.1, 8179.5, 8187.9, 8196.1, 8204.6, 8212.9, 8221.3, 8229.4, 8237.8, 8246.2, 8254.8, 8263.1, 8271.4, 8279.8, 8287.7, 8296, 8304.3, 8312.7, 8321, 8329.4, 8338.1,
        8346.4, 8354.3, 8362.7, 8371.1, 8379.7, 8388, 8396.1, 8404.3, 8412.7, 8421, 8429.3, 8437.8, 8446, 8454.6, 8463, 8471.3, 8479.3, 8487.7, 8496.4, 8504.7, 8512.9, 8521.4, 8529.3, 8538, 8546,
        8554.3, 8563, 8571.2, 8579.6, 8587.9, 8596.3, 8604.2, 8612.6, 8620.9, 8629.4, 8637.7, 8646.2, 8654.6, 8662.8, 8670.9, 8679.4, 8687.5, 8696.2, 8704.6, 8712.9, 8721.3, 8729.2, 8737.6, 8746,
        8754.5, 8762.8, 8771.2, 8779.5, 8787.4, 8795.8, 8804.4, 8812.5, 8821.1, 8829.5, 8837.4, 8845.7, 8854.1, 8862.5, 8871.1, 8879.4, 8887.7, 8896.1, 8904.1, 8912.7, 8921.1, 8929.2, 8937.4, 8945.8,
        8954, 8962.3, 8971, 8979.2, 8987.7, 8996.1, 9004.1, 9012.3, 9021, 9029, 9037.4, 9045.7, 9054.1, 9062.3, 9070.7, 9079.3, 9087.7, 9095.6, 9104, 9112.3, 9120.9, 9129.3, 9137.6, 9146, 9154,
        9162.3, 9171, 9179.2, 9187.6, 9196, 9204.3, 9212.6, 9220.5, 9229, 9237.6, 9245.9, 9254.3, 9262.5, 9270.9, 9278.9, 9287.6, 9296, 9304.2, 9312.3, 9321, 9328.9, 9337.3, 9345.5, 9354, 9362.4,
        9370.9, 9378.9, 9387.3, 9395.5, 9403.9, 9412.5, 9420.8, 9429.2, 9437.6, 9445.9, 9453.8, 9462.2, 9470.4, 9478.9
      ];
      const sin = arr.map((v) => Math.sin(v / 1000));
      const cos = arr.map((v) => Math.cos(v / 1000));
      const path = arr.map((v, i) => ({ x: sin[i] * 10, z: cos[i] * 10 }));

      // let stop = false;
      // let i = 0;
      // const arr1 = []
      // function animate() {
      //   requestAnimationFrame((time) => {
      //     if (stop) return
      //     arr1.push(time)
      //     topActor?.setPosition(Math.sin(time / 1000) * 10, 0, Math.cos(time / 1000) * 10)
      //     console.log(time);
      //     animate();
      //   })
      // }
      // animate();
      // setTimeout(() => {
      //   stop = true;
      //   console.log(arr1);
      // }, 8000);
      //
      // setInterval(() => {
      //   bottomActor?.setPosition(path[i].x, 0, path[i].z)
      //   i++;
      // }, 600);

      // const path = [{ x: 12 }, { z: -12 }, { x: -20 }, { z: 2 }];
      void standardMoverService.goByPath(bottomActor, path, { ...animationParams, easing: Easing.Linear });
    });
  }

  return { start, level };
}
